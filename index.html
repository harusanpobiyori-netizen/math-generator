<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>算数プリント自動生成</title>
  <style>
    body{font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif;margin:16px}
    .card{border:1px solid #ddd;border-radius:10px;padding:12px;margin-bottom:12px}
    .row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
    input[type="number"],input[type="text"]{padding:6px;width:120px}
    button{padding:8px 12px;cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px 18px;margin-top:14px}
    .q{border-bottom:1px dotted #bbb;padding-bottom:4px;white-space:nowrap}
    @media print{
      .no-print{display:none!important}
      body{margin:0}
      #sheet{padding:18mm 15mm}
      .q{border-bottom:1px solid #000}
    }
  </style>
</head>
<body>
  <div class="card no-print">
    <div class="row"><strong>算数プリント生成</strong></div>
    <div class="row">
      <label><input type="checkbox" id="opAdd" checked>＋</label>
      <label><input type="checkbox" id="opSub" checked>－</label>
      <label><input type="checkbox" id="opMul">×</label>
      <label><input type="checkbox" id="opDiv">÷</label>
    </div>
    <div class="row">
      <label>数字上限 <input type="number" id="maxNum" value="100" min="5"></label>
      <label>問題数 <input type="number" id="count" value="20" min="5" max="200"></label>
      <label>seed <input type="text" id="seed" placeholder="空なら自動"></label>
      <button id="btnGen">生成</button>
      <button id="btnPrint">印刷/保存(PDF)</button>
    </div>
  </div>

  <div id="sheet" class="card">
    <div class="row" style="justify-content:space-between">
      <div><strong>算数プリント</strong> <span id="meta" style="font-size:12px;color:#444"></span></div>
      <div style="font-size:12px;color:#444;text-align:right">
        氏名：＿＿＿＿＿＿＿＿＿＿＿<br>日付：＿＿＿＿／＿＿＿＿
      </div>
    </div>
    <div id="grid" class="grid"></div>
  </div>

<script>
function xfnv1a(str){let h=2166136261>>>0;for(let i=0;i<str.length;i++){h^=str.charCodeAt(i);h=Math.imul(h,16777619)}return h>>>0}
function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^(t>>>15),t|1);t^=t+Math.imul(t^(t>>>7),t|61);return((t^(t>>>14))>>>0)/4294967296}}
function randInt(r,min,max){return Math.floor(r()*(max-min+1))+min}
function pick(r,arr){return arr[Math.floor(r()*arr.length)]}
function getOps(){const ops=[];if(opAdd.checked)ops.push('+');if(opSub.checked)ops.push('-');if(opMul.checked)ops.push('*');if(opDiv.checked)ops.push('/');return ops}
function genOne(r,op,maxNum){
  if(op==='+'){const a=randInt(r,0,maxNum),b=randInt(r,0,maxNum);return {k:`+:${a},${b}`,d:`${a} + ${b} =`}}
  if(op==='-'){let a=randInt(r,0,maxNum),b=randInt(r,0,maxNum);if(b>a)[a,b]=[b,a];return {k:`-:${a},${b}`,d:`${a} - ${b} =`}}
  if(op==='*'){const lim=Math.max(5,Math.floor(Math.sqrt(maxNum)));let a=randInt(r,0,lim),b=randInt(r,0,lim);return {k:`*:${a},${b}`,d:`${a} × ${b} =`}}
  if(op==='/'){const d=randInt(r,1,12),q=randInt(r,0,12);const a=d*q,b=d; if(a>maxNum) return null; return {k:`/:${a},${b}`,d:`${a} ÷ ${b} =`}}
}
function genSheet(){
  const ops=getOps(); if(!ops.length){alert('演算を選択してください');return;}
  const maxNum=Number(maxNumEl.value), count=Number(countEl.value);
  let s=seedEl.value.trim(); if(!s){s=String(Date.now()); seedEl.value=s;}
  const r=mulberry32(xfnv1a(s));
  const used=new Set(); const qs=[];
  while(qs.length<count){
    const op=pick(r,ops);
    const q=genOne(r,op,maxNum); if(!q) continue;
    if(used.has(q.k)) continue;
    used.add(q.k); qs.push(q.d);
    if(used.size>5000) break;
  }
  meta.textContent=`（上限=${maxNum} / 問題数=${count} / seed=${s}）`;
  grid.innerHTML=qs.map((t,i)=>`<div class="q">${i+1}. ${t}</div>`).join('');
}
const opAdd=document.getElementById('opAdd');
const opSub=document.getElementById('opSub');
const opMul=document.getElementById('opMul');
const opDiv=document.getElementById('opDiv');
const maxNumEl=document.getElementById('maxNum');
const countEl=document.getElementById('count');
const seedEl=document.getElementById('seed');
const grid=document.getElementById('grid');
const meta=document.getElementById('meta');
document.getElementById('btnGen').addEventListener('click',genSheet);
document.getElementById('btnPrint').addEventListener('click',()=>window.print());
genSheet();
</script>
</body>
</html>
